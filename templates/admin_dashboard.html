<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ•ç¥¨ç®¡ç†åå°</title>
    <!-- å¼•å…¥ Pico.css æ¡†æ¶ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <!-- å¼•å…¥ Chart.js ç”¨äºå›¾è¡¨æ˜¾ç¤º -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* é¡µé¢æ•´ä½“æ ·å¼ï¼šä½¿ç”¨ä¸å…¶ä»–é¡µé¢ç›¸åŒçš„JPEGå›¾ç‰‡å¹³é“ºèƒŒæ™¯ */
        body {
            background-image: url("{{ url_for('static', filename='images/background.jpg') }}");
            background-repeat: repeat;
            background-size: 300px 300px;
            min-height: 100vh;
            padding: 20px;
            position: relative; /* ä¸ºåŠé€æ˜é®ç½©åšå‡†å¤‡ */
        }
        
        /* æ·»åŠ åŠé€æ˜é®ç½©å±‚ï¼Œç¡®ä¿è¡¨å•å†…å®¹å¯è¯» */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.85); /* ç™½è‰²åŠé€æ˜é®ç½© */
            z-index: 0;
        }

        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative; /* ç¡®ä¿å†…å®¹åœ¨é®ç½©ä¹‹ä¸Š */
            z-index: 1;
        }
        
        /* é¡¶éƒ¨æ§åˆ¶æ  */
        .admin-header {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ç½‘æ ¼ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡æ ·å¼ */
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        /* è®¾ç½®ç­”æ¡ˆåŒºåŸŸ */
        .answer-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* è¡¨æ ¼åŒºåŸŸ */
        .table-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            overflow-x: auto;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .data-table th {
            background: #2c3e50;
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: bold;
        }
        
        .data-table td {
            padding: 0.8rem 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .data-table tr:hover {
            background: #f9f9f9;
        }
        
        /* çŠ¶æ€æ ‡ç­¾ */
        .status-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }
        
        .voted-badge {
            background: #d4edda;
            color: #155724;
        }
        
        .not-voted-badge {
            background: #fff3cd;
            color: #856404;
        }
        
        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 2rem 0;
        }
        
        /* æ“ä½œæŒ‰é’® */
        .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }
        
        .action-btn {
            padding: 0.8rem 1.5rem;
            border-radius: 10px;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .refresh-btn {
            background: #3498db;
            color: white;
        }
        
        .refresh-btn:hover {
            background: #2980b9;
        }
        
        .logout-btn {
            background: #e74c3c;
            color: white;
        }
        
        .logout-btn:hover {
            background: #c0392b;
        }
        
        .view-btn {
            background: #27ae60;
            color: white;
        }
        
        .view-btn:hover {
            background: #219653;
        }
        
        /* è®¾ç½®ç­”æ¡ˆè¡¨å• */
        .answer-form {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        .answer-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* æˆåŠŸ/é”™è¯¯æ¶ˆæ¯ */
        .message-box {
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            display: none;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .admin-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .action-buttons {
                width: 100%;
            }
            
            .answer-form {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .data-table {
                font-size: 0.9rem;
            }
            
            .data-table th,
            .data-table td {
                padding: 0.6rem;
            }
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* åˆ†é¡µæ§åˆ¶ */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 2rem;
        }
        
        .page-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .page-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 1. é¡¶éƒ¨æ§åˆ¶æ  -->
        <div class="admin-header">
            <div>
                <h1 style="color: #2c3e50; margin-bottom: 0.5rem;">ğŸ“‹ æŠ•ç¥¨ç®¡ç†åå°</h1>
                <p style="color: #666; margin: 0;">
                    æ´»åŠ¨PINç ï¼š<strong>{{ event.event_password }}</strong> | 
                    æˆªæ­¢æ—¶é—´ï¼š{{ event.end_date.strftime('%Y-%m-%d %H:%M:%S') if event.end_date else 'æœªè®¾ç½®' }}
                </p>
            </div>
            
            <div class="action-buttons">
                <button onclick="refreshData()" class="action-btn refresh-btn">
                    ğŸ”„ åˆ·æ–°æ•°æ®
                </button>
                <a href="{{ url_for('index') }}" class="action-btn view-btn">
                    ğŸ‘€ æŸ¥çœ‹æŠ•ç¥¨é¡µé¢
                </a>
                <button onclick="logout()" class="action-btn logout-btn">
                    ğŸšª é€€å‡ºç™»å½•
                </button>
            </div>
        </div>
        
        <!-- 2. ç»Ÿè®¡æ•°æ®å¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>ğŸ‘¥ æ€»å‚ä¸äººæ•°</h3>
                <p style="font-size: 2.5rem; color: #3498db; margin: 0.5rem 0;">
                    {{ participants|length }}
                </p>
                <p style="color: #666; font-size: 0.9rem;">å·²æ³¨å†Œç”¨æˆ·æ€»æ•°</p>
            </div>
            
            <div class="stat-card">
                <h3>ğŸ‘¶ ç”·å­©ç¥¨æ•°</h3>
                <p style="font-size: 2.5rem; color: #2196f3; margin: 0.5rem 0;">
                    {{ stats['ç”·å­©'] }}
                </p>
                <p style="color: #666; font-size: 0.9rem;">å æ¯”ï¼š{% if total_votes > 0 %}{{ (stats['ç”·å­©'] / total_votes * 100)|round(1) }}%{% else %}0%{% endif %}</p>
            </div>
            
            <div class="stat-card">
                <h3>ğŸ‘§ å¥³å­©ç¥¨æ•°</h3>
                <p style="font-size: 2.5rem; color: #e91e63; margin: 0.5rem 0;">
                    {{ stats['å¥³å­©'] }}
                </p>
                <p style="color: #666; font-size: 0.9rem;">å æ¯”ï¼š{% if total_votes > 0 %}{{ (stats['å¥³å­©'] / total_votes * 100)|round(1) }}%{% else %}0%{% endif %}</p>
            </div>
            
            <div class="stat-card">
                <h3>âœ… å·²æŠ•ç¥¨äººæ•°</h3>
                <p style="font-size: 2.5rem; color: #27ae60; margin: 0.5rem 0;">
                    {{ voted_count }}
                </p>
                <p style="color: #666; font-size: 0.9rem;">æŠ•ç¥¨ç‡ï¼š{% if participants|length > 0 %}{{ (voted_count / participants|length * 100)|round(1) }}%{% else %}0%{% endif %}</p>
            </div>
        </div>
        
        <!-- 3. è®¾ç½®æ­£ç¡®ç­”æ¡ˆåŒºåŸŸ -->
        <div class="answer-section">
            <h3 style="margin-bottom: 1rem;">ğŸ† è®¾ç½®æ­£ç¡®ç­”æ¡ˆ</h3>
            <p style="color: #666; margin-bottom: 1rem;">
                è®¾ç½®æ­£ç¡®ç­”æ¡ˆåï¼Œç”¨æˆ·å¯ä»¥åœ¨"æŸ¥çœ‹ä¸­å¥–çŠ¶æ€"é¡µé¢çœ‹åˆ°ç»“æœã€‚å½“å‰ç­”æ¡ˆï¼š
                <strong id="currentAnswer">{{ event.correct_option if event.correct_option else 'æœªè®¾ç½®' }}</strong>
            </p>
            
            <div class="answer-form" id="answerForm">
                <div class="answer-option">
                    <input type="radio" id="boyAnswer" name="answer" value="ç”·å­©" 
                           {% if event.correct_option == 'ç”·å­©' %}checked{% endif %}>
                    <label for="boyAnswer">ğŸ‘¶ ç”·å­©</label>
                </div>
                
                <div class="answer-option">
                    <input type="radio" id="girlAnswer" name="answer" value="å¥³å­©"
                           {% if event.correct_option == 'å¥³å­©' %}checked{% endif %}>
                    <label for="girlAnswer">ğŸ‘§ å¥³å­©</label>
                </div>
                
                <button type="button" onclick="setAnswer()" class="action-btn" style="background: #9b59b6; color: white;">
                    ğŸ’¾ ä¿å­˜ç­”æ¡ˆ
                </button>
                
                <button type="button" onclick="clearAnswer()" class="action-btn" style="background: #95a5a6; color: white;">
                    ğŸ—‘ï¸ æ¸…é™¤ç­”æ¡ˆ
                </button>
            </div>
            
            <div id="answerMessage" class="message-box"></div>
        </div>
        
        <!-- 4. å›¾è¡¨åŒºåŸŸ -->
        <div class="answer-section">
            <h3 style="margin-bottom: 1rem;">ğŸ“Š æŠ•ç¥¨åˆ†å¸ƒå›¾è¡¨</h3>
            <div class="chart-container">
                <canvas id="distributionChart"></canvas>
            </div>
        </div>
        
        <!-- 5. å‚ä¸è€…åˆ—è¡¨ -->
        <div class="table-section">
            <h3 style="margin-bottom: 1rem;">ğŸ“ å‚ä¸è€…åˆ—è¡¨ï¼ˆå…± {{ participants|length }} äººï¼‰</h3>
            
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>æ˜µç§°</th>
                            <th>è”ç³»æ–¹å¼</th>
                            <th>æŠ•ç¥¨çŠ¶æ€</th>
                            <th>æŠ•ç¥¨é€‰æ‹©</th>
                            <th>æŠ•ç¥¨æ—¶é—´</th>
                            <th>æ³¨å†Œæ—¶é—´</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for participant in participants %}
                        <tr>
                            <td>{{ participant.id }}</td>
                            <td>{{ participant.nickname }}</td>
                            <td>{{ participant.contact_info }}</td>
                            <td>
                                {% if participant.has_voted %}
                                <span class="status-badge voted-badge">âœ… å·²æŠ•ç¥¨</span>
                                {% else %}
                                <span class="status-badge not-voted-badge">â³ æœªæŠ•ç¥¨</span>
                                {% endif %}
                            </td>
                            <td>
                                {% for vote in participant.votes %}
                                    {{ vote.option_chosen }}
                                {% else %}
                                    -
                                {% endfor %}
                            </td>
                            <td>
                                {% for vote in participant.votes %}
                                    {{ vote.vote_time.strftime('%m-%d %H:%M') }}
                                {% else %}
                                    -
                                {% endfor %}
                            </td>
                            <td>{{ participant.created_at.strftime('%m-%d %H:%M') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- åˆ†é¡µæ§åˆ¶ï¼ˆå¦‚æœæœ‰å¤§é‡æ•°æ®ï¼‰ -->
            {% if participants|length > 20 %}
            <div class="pagination">
                <button class="page-btn active">1</button>
                <button class="page-btn">2</button>
                <button class="page-btn">3</button>
                <!-- å¯ä»¥æ·»åŠ æ›´å¤šåˆ†é¡µæŒ‰é’® -->
            </div>
            {% endif %}
        </div>
        
        <!-- 6. æŠ•ç¥¨è¯¦æƒ…è¡¨æ ¼ -->
        <div class="table-section">
            <h3 style="margin-bottom: 1rem;">ğŸ—³ï¸ æŠ•ç¥¨è¯¦æƒ…</h3>
            
            <div style="display: flex; gap: 2rem; flex-wrap: wrap; margin-bottom: 1.5rem;">
                <div>
                    <h4 style="color: #2196f3; margin-bottom: 0.5rem;">ğŸ‘¶ ç”·å­©æŠ•ç¥¨åå•ï¼ˆ{{ votes_by_option['ç”·å­©']|length }}äººï¼‰</h4>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        {% for vote in votes_by_option['ç”·å­©'] %}
                        <li style="margin-bottom: 0.3rem;">{{ vote.participant.nickname }} ({{ vote.vote_time.strftime('%H:%M') }})</li>
                        {% endfor %}
                    </ul>
                </div>
                
                <div>
                    <h4 style="color: #e91e63; margin-bottom: 0.5rem;">ğŸ‘§ å¥³å­©æŠ•ç¥¨åå•ï¼ˆ{{ votes_by_option['å¥³å­©']|length }}äººï¼‰</h4>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        {% for vote in votes_by_option['å¥³å­©'] %}
                        <li style="margin-bottom: 0.3rem;">{{ vote.participant.nickname }} ({{ vote.vote_time.strftime('%H:%M') }})</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- 7. æ•°æ®å¯¼å‡ºåŒºåŸŸ -->
        <div class="answer-section">
            <h3 style="margin-bottom: 1rem;">ğŸ“¤ æ•°æ®å¯¼å‡º</h3>
            <p style="color: #666; margin-bottom: 1rem;">å°†æŠ•ç¥¨æ•°æ®å¯¼å‡ºä¸ºCSVæ ¼å¼ï¼Œå¯ç”¨äºExcelæˆ–æ•°æ®åˆ†æã€‚</p>
            
            <div class="action-buttons">
                <button onclick="exportData('participants')" class="action-btn" style="background: #3498db; color: white;">
                    ğŸ“„ å¯¼å‡ºå‚ä¸è€…æ•°æ®
                </button>
                <button onclick="exportData('votes')" class="action-btn" style="background: #9b59b6; color: white;">
                    ğŸ“Š å¯¼å‡ºæŠ•ç¥¨æ•°æ®
                </button>
                <button onclick="exportData('all')" class="action-btn" style="background: #27ae60; color: white;">
                    ğŸ’¾ å¯¼å‡ºå…¨éƒ¨æ•°æ®
                </button>
            </div>
        </div>
    </div>

    <script>
        // ä»åç«¯ä¼ é€’çš„æ•°æ®ä¸­è·å–ç»Ÿè®¡ä¿¡æ¯
        const statsData = { stats , tojson };
        const totalVotesData = { total_votes };
        
        // å‡†å¤‡å›¾è¡¨æ•°æ®
        const chartData = {
            labels: ['ç”·å­© ğŸ‘¶', 'å¥³å­© ğŸ‘§'],
            datasets: [{
                data: [statsData['ç”·å­©'], statsData['å¥³å­©']],
                backgroundColor: [
                    'rgba(33, 150, 243, 0.8)',
                    'rgba(233, 30, 99, 0.8)'
                ],
                borderColor: [
                    'rgb(33, 150, 243)',
                    'rgb(233, 30, 99)'
                ],
                borderWidth: 2,
                hoverOffset: 15
            }]
        };
        
        // åˆ›å»ºé¥¼å›¾
        const ctx = document.getElementById('distributionChart').getContext('2d');
        const distributionChart = new Chart(ctx, {
            type: 'pie',
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                const percentage = totalVotesData > 0 ? 
                                    Math.round((value / totalVotesData) * 100) : 0;
                                return `${label}: ${value} ç¥¨ (${percentage}%)`;
                            }
                        }
                    }
                },
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
            }
        });
        
        // è®¾ç½®æ­£ç¡®ç­”æ¡ˆ
        async function setAnswer() {
            const answerForm = document.getElementById('answerForm');
            const formData = new FormData(answerForm);
            const answer = formData.get('answer');
            const messageBox = document.getElementById('answerMessage');
            
            if (!answer) {
                showMessage('è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆï¼ˆç”·å­©æˆ–å¥³å­©ï¼‰', 'error');
                return;
            }
            
            try {
                const response = await fetch('/admin/set_answer', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('currentAnswer').textContent = data.answer;
                    showMessage(`æ­£ç¡®ç­”æ¡ˆå·²è®¾ç½®ä¸ºï¼š${data.answer}`, 'success');
                } else {
                    showMessage(`è®¾ç½®å¤±è´¥ï¼š${data.error}`, 'error');
                }
            } catch (error) {
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }
        
        // æ¸…é™¤ç­”æ¡ˆ
        async function clearAnswer() {
            if (!confirm('ç¡®å®šè¦æ¸…é™¤æ­£ç¡®ç­”æ¡ˆå—ï¼Ÿæ¸…é™¤åç”¨æˆ·å°†çœ‹ä¸åˆ°ä¸­å¥–ç»“æœã€‚')) {
                return;
            }
            
            try {
                const response = await fetch('/admin/clear_answer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('currentAnswer').textContent = 'æœªè®¾ç½®';
                    // å–æ¶ˆé€‰ä¸­æ‰€æœ‰å•é€‰æŒ‰é’®
                    document.querySelectorAll('input[name="answer"]').forEach(radio => {
                        radio.checked = false;
                    });
                    showMessage('æ­£ç¡®ç­”æ¡ˆå·²æ¸…é™¤', 'success');
                } else {
                    showMessage(`æ¸…é™¤å¤±è´¥ï¼š${data.error}`, 'error');
                }
            } catch (error) {
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message, type) {
            const messageBox = document.getElementById('answerMessage');
            messageBox.textContent = message;
            messageBox.className = 'message-box ' + (type === 'success' ? 'success-message' : 'error-message');
            messageBox.style.display = 'block';
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 3000);
        }
        
        // åˆ·æ–°æ•°æ®
        function refreshData() {
            window.location.reload();
        }
        
        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç®¡ç†å‘˜ç™»å½•å—ï¼Ÿ')) {
                window.location.href = '/admin/logout';
            }
        }
        
        // æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼ˆæ¨¡æ‹Ÿï¼‰
        function exportData(type) {
            let filename = '';
            let data = '';
            
            switch(type) {
                case 'participants':
                    filename = 'å‚ä¸è€…æ•°æ®.csv';
                    data = 'ID,æ˜µç§°,è”ç³»æ–¹å¼,æŠ•ç¥¨çŠ¶æ€,æŠ•ç¥¨é€‰æ‹©,æŠ•ç¥¨æ—¶é—´,æ³¨å†Œæ—¶é—´\n';
                    // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„æ•°æ®å¯¼å‡ºé€»è¾‘
                    break;
                case 'votes':
                    filename = 'æŠ•ç¥¨æ•°æ®.csv';
                    data = 'æŠ•ç¥¨ID,å‚ä¸è€…ID,é€‰é¡¹,æŠ•ç¥¨æ—¶é—´\n';
                    // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„æ•°æ®å¯¼å‡ºé€»è¾‘
                    break;
                case 'all':
                    filename = 'æŠ•ç¥¨ç³»ç»Ÿå®Œæ•´æ•°æ®.csv';
                    data = 'æ•°æ®ç±»å‹,ID,è¯¦ç»†ä¿¡æ¯\n';
                    // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„æ•°æ®å¯¼å‡ºé€»è¾‘
                    break;
            }
            
            // æ¨¡æ‹Ÿå¯¼å‡ºï¼ˆå®é™…åº”ç”¨ä¸­éœ€è¦åç«¯æ”¯æŒï¼‰
            const blob = new Blob([data], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
            
            showMessage(`æ­£åœ¨å¯¼å‡º${filename}...`, 'success');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        window.onload = function() {
            // å¦‚æœæœ‰æ–°æ¶ˆæ¯ï¼Œæ»šåŠ¨åˆ°æ¶ˆæ¯ä½ç½®
            const messageBox = document.getElementById('answerMessage');
            if (messageBox.style.display === 'block') {
                messageBox.scrollIntoView({ behavior: 'smooth' });
            }
        };
    </script>
</body>
</html>